# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on merge
'on':
  push:
    branches:
      - '*/*'

env:
  DEPLOY_URL: https://www.google.com
  
jobs:
  build_and_deploy:
    environment:
      name: Preview-url
      url: https://www.google.com
      
    runs-on: ubuntu-latest
    steps:
      - name: Cloning the Repository
        uses: actions/checkout@v2
        
      - name: Running npm Build
        run: |
          cd frontend
          npm ci && npm run build
      
      - name: Deploying to Firebase
        uses: FirebaseExtended/action-hosting-deploy@v0
        id: deploy
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_WEBAPP_ISM }}'
          channelId: preview
          projectId: webapp-ism
          entryPoint: ./frontend
          
      - name: Echo the url
        run: echo Hello '${{ env.DEPLOY_URL }}' url '${{ steps.deploy.outputs.details_url }}' expiretime "${{ steps.deploy.outputs.expire_time }}" urlList  "${{ steps.deploy.outputs.urls }}"


      - name: Create commit comment
        uses: peter-evans/commit-comment@v1
        with:
         body: |
          This webapp is hosted at the following url:
          - [${{steps.deploy.outputs.urls}}](${{steps.deploy.outputs.urls}})
          - **URL** ${{steps.deploy.outputs.urls}}
          - ${{steps.deploy.outputs.details_url}}
          - **Expire on** ${{steps.deploy.outputs.expire_time}}
